<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>주문등록</h1>
    <form action="/orders/create-order" method="post" name="Createorder">
        <p>주문자  <input id="orderName" type="text" name="order-name" placeholder="주문자" ></p>
        <p>상품명  <input id="itemName" type="text" name="item-name" placeholder="상품명" maxlength="10"></p>
        <p>상품명1 </p>

        <select name="itemSelect" id="itemSelect">
            
        </select>

        <p>수량  <input id="quantity" type="number" name="quantity" placeholder="수량" min="1" max="100"/></p>
        <p>가격  <input id="price" type="text" name="price" placeholder="총금액" ></p>  
        <div style="line-height:60%;">
            <br>
            <br>
        </div>
        <div class="button-box">
            <button type="submit">등록</button>
        </div>
    </form>




    <script type="text/javascript">
        // json 형식으로 데이터가져오기 //
        var messages = "[[${items}]]";
	    var jsonMessage = messages.replace(/&quot;/g, "\""); // 서버랑 웹페이지랑 JSON 양식이 달라서 맞춰줌

        addSelectRow("#itemSelect", "쓰레기", "1");
        addSelectRow("#itemSelect", "사과", "2");
        addSelectRow("#itemSelect", "뽀뽀", "3");

        jsonfunc(jsonMessage); // JSON 을 파싱해서 HTML 로 표현함


        function jsonfunc( jsonText ) {
            let arrname = new Array(); // 상품명 배열
            let arrsalePrice = new Array(); // 판매가 배열
            let arrstock = new Array(); // 재고수량 배열

            let json = JSON.parse(jsonText); // JSON 형식으로 뽑아서 객체화

            for (i=0; i< json.length; i++) {
                console.log(i + "번째 데이터");
                console.log(json[i]);

                arrname[i] = json[i].name;
                arrsalePrice[i] = json[i].salePrice;
                arrstock[i] = json[i].stock;
            }
           
            // let select = document.getElementById('select')
            
            // for(i=0; i<arrname.length; i++){
            //     let option = document.createElement("option"); 
            //     let option1 = document.createElement("option");	
            //     option1.appendChild(document.createTextNode(arrname[i] + "")); 
            // }
        }

        // 드롭박스 추가하기
        function addSelectRow(selectName, optionText, optionValue) { // "#itemSelect", json[i].itemName, json[i].itemId
            let objSelect = document.querySelector(selectName);
            var objOption = document.createElement("option");
            objOption.text = optionText;
            objOption.value = optionValue;
            objSelect.options.add(objOption);
        }


        // json 형식으로 자료보내기 // 
        const Createorder = document.querySelector('.form') 

        Createorder.addEventListener('submit', event => {
            event.preventDefault();
            const CreateOrerData = new CreateOrderData(Createorder);
            const data = Object.fromEntries(CreateOrderData);

        fetch("/orders/create-order", {
            method : 'get',
            headers : {
                "Content-Type" : "application/json"
            },
            body : JSON.stringify(data),
        }).then(res => res.json())
          .then(data => console.log(data))
          .catch(error => console.log(error))
    });
    </script>
   
</body>
</html>